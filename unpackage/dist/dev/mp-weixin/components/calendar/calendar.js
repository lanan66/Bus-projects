"use strict";const o=require("../../common/vendor.js"),f={name:"ren-calendar",props:{weekstart:{type:Number,default:1},markDays:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},collapsible:{type:Boolean,default:!0},disabledAfter:{type:Boolean,default:!1}},data(){return{weektext:["日","一","二","三","四","五","六"],y:new Date().getFullYear(),m:new Date().getMonth()+1,dates:[],positionTop:0,monthOpen:!1,choose:"",nowtime:"",headerBar:!1}},created(){this.dates=this.monthDay(this.y,this.m),!this.open&&this.toggle()},mounted(){this.choose=this.getToday().date,this.init(),this.getnowtime()},computed:{weekDay(){return this.weektext.slice(this.weekstart).concat(this.weektext.slice(0,this.weekstart))},height(){return this.dates.length/7*80+"rpx"}},methods:{formatNum(e){let r=Number(e);return r<10?"0"+r:r},getToday(){let e=new Date,r=e.getFullYear(),t=e.getMonth(),h=e.getDate(),a=new Date().getDay(),s="星期"+["日","一","二","三","四","五","六"][a];return{date:r+"-"+this.formatNum(t+1)+"-"+this.formatNum(h),week:s}},getnowtime(){let e=new Date,r=e.getFullYear(),t=e.getMonth(),h=e.getDate();this.nowtime=r+"-"+this.formatNum(t+1)+"-"+this.formatNum(h)},monthDay(e,r){let t=[],h=Number(r),a=new Date(e,h-1,1).getDay(),n=new Date(e,h,0).getDate(),s=new Date(e,h-2,0).getDate(),l=this.weekstart==7?0:this.weekstart,m=(()=>a==l?0:a>l?a-l:7-l+a)(),u=7-(m+n)%7;for(let i=1;i<=m;i++)t.push({date:this.formatNum(s-m+i),day:l+i-1||7,month:h-1>=0?this.formatNum(h-1):12,year:h-1>=0?e:e-1});for(let i=1;i<=n;i++)t.push({date:this.formatNum(i),day:i%7+a-1||7,month:this.formatNum(h),year:e,isCurM:!0});for(let i=1;i<=u;i++)t.push({date:this.formatNum(i),day:(n+m+l+i-1)%7||7,month:h+1<=11?this.formatNum(h+1):0,year:h+1<=11?e:e+1});return t},isWorkDay(e,r,t){let h=`${e}/${r}/${t}`,n=new Date(h.replace(/-/g,"/")).getDay();return!(n==0||n==6)},isFutureDay(e,r,t){let h=`${e}/${r}/${t}`,n=new Date(h.replace(/-/g,"/")).getTime(),s=new Date().getTime();return n>s},isMarkDay(e,r,t){let h=!1;for(let a=0;a<this.markDays.length;a++){let n=`${e}-${r}-${t}`;if(this.markDays[a]==n){h=!0;break}}return h},isToday(e,r,t){let h=e+"-"+r+"-"+t,a=this.getToday().date;return h==a},toggle(){if(this.monthOpen=!this.monthOpen,this.headerBar=!this.headerBar,this.monthOpen)this.positionTop=0;else{let e=-1;this.dates.forEach((r,t)=>{this.isToday(r.year,r.month,r.date)&&(e=t)}),this.positionTop=-((Math.ceil((e+1)/7)||1)-1)*80}},init(){let e=-1;this.dates.forEach((r,t)=>{this.isToday(r.year,r.month,r.date)&&(e=t)}),this.positionTop=-((Math.ceil((e+1)/7)||1)-1)*80},selectOne(e,r){let t=`${e.year}-${e.month}-${e.date}`,h=new Date(t).getTime(),a=new Date().getTime(),n=new Date(t).getDay(),l="星期"+["日","一","二","三","四","五","六"][n],m={date:t,week:l};if(!e.isCurM)return!1;if(h>a){if(this.disabledAfter)return console.log("未来日期不可选"),!1;this.choose=t,this.$emit("onDayClick",m)}else this.choose=t,this.$emit("onDayClick",m);this.nowtime=m.date,console.log("---",m)},changYearMonth(e,r){this.dates=this.monthDay(e,r),this.y=e,this.m=r},changeMonth(e){e=="pre"?this.m+1==2?(this.m=12,this.y=this.y-1):this.m=this.m-1:this.m+1==13?(this.m=1,this.y=this.y+1):this.m=this.m+1,this.dates=this.monthDay(this.y,this.m)}}};function d(e,r,t,h,a,n){return o.e({a:o.t(a.nowtime),b:a.headerBar},a.headerBar?{c:o.o(s=>n.changeMonth("pre")),d:o.t(a.y+"年"+n.formatNum(a.m)+"月"),e:o.o(s=>n.changeMonth("next"))}:{},{f:o.f(n.weekDay,(s,l,m)=>({a:o.t(s),b:l})),g:o.f(a.dates,(s,l,m)=>o.e({a:o.t(Number(s.date)),b:o.o(u=>n.selectOne(s,u),l),c:a.choose==`${s.year}-${s.month}-${s.date}`&&s.isCurM?1:"",d:s.isCurM?"":1,e:n.isWorkDay(s.year,s.month,s.date)?1:"",f:n.isMarkDay(s.year,s.month,s.date)&&s.isCurM},n.isMarkDay(s.year,s.month,s.date)&&s.isCurM?{}:{},{g:l})),h:a.positionTop+"rpx",i:a.monthOpen?"":1,j:n.height,k:a.monthOpen==!1},a.monthOpen==!1?o.e({l:t.collapsible},t.collapsible?{}:{}):{},{m:a.monthOpen==!0},a.monthOpen==!0?o.e({n:t.collapsible},t.collapsible?{}:{}):{},{o:o.o((...s)=>n.toggle&&n.toggle(...s))})}const c=o._export_sfc(f,[["render",d],["__scopeId","data-v-3a94fe31"],["__file","C:/Users/chen/Desktop/公交项目/Bus-projects/components/calendar/calendar.vue"]]);wx.createComponent(c);
